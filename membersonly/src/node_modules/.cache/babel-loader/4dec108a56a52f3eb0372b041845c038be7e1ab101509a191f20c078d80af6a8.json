{"ast":null,"code":"import store from \"../store/index\";\nimport { mapState } from \"vuex\";\nimport http from \"@/utils/request\";\nimport { ElMessage } from \"element-plus\";\nexport default {\n  data() {\n    return {\n      isCollapse: false,\n      handleCollapse: null,\n      avg: \"\"\n    };\n  },\n  computed: {\n    ...mapState({\n      userInfo: state => state.userInfo\n    }),\n    gravatarUrl() {\n      if (this.userInfo && this.userInfo.emailAddress) {\n        return this.userInfo.avatar === null ? \"http://akarana.oss-ap-southeast-1.aliyuncs.com/car1.jpg\" : this.userInfo.avatar;\n      }\n      return \"\";\n    }\n  },\n  methods: {\n    choose(event) {\n      let e = window.event || event;\n      if (e.target.files[0].size > 5 * 1024 * 1024) {} else {\n        let file = e.target.files[0];\n        const formdate = new FormData();\n        formdate.append(\"avatar\", file);\n        this.formdate = formdate;\n        let reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.onload = result => {\n          this.file = result.target.result;\n        };\n      }\n\n      // 添加选择完成提示\n      ElMessage({\n        message: \"Choose Complete\",\n        type: \"success\"\n      });\n    },\n    async uploadImg() {\n      const {\n        data\n      } = await http.post(`/api/avatar/${this.userInfo.username}`, this.formdate, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\"\n        }\n      });\n      console.log(data);\n      localStorage.removeItem(\"userInfo\");\n      store.dispatch({\n        type: \"getUserInfo\",\n        payload: this.userInfo.id\n      });\n\n      // 添加上传成功提示\n      ElMessage({\n        message: \"Confirmed\",\n        type: \"success\"\n      });\n    }\n  }\n};","map":{"version":3,"names":["store","mapState","http","ElMessage","data","isCollapse","handleCollapse","avg","computed","userInfo","state","gravatarUrl","emailAddress","avatar","methods","choose","event","e","window","target","files","size","file","formdate","FormData","append","reader","FileReader","readAsDataURL","onload","result","message","type","uploadImg","post","username","headers","console","log","localStorage","removeItem","dispatch","payload","id"],"sources":["/Users/wucongzhen/Documents/GitHub/Akarana/src/src/views/Avatar.vue"],"sourcesContent":["<template>\n  <Header :handleCollapse=\"handleCollapse\" :isCollapse=\"isCollapse\"> </Header>\n\n  <div class=\"user-profile\">\n    <h2 class=\"profile-title\">Edit My Avatar</h2>\n    <div v-if=\"userInfo\" class=\"profile-content\">\n      <img :src=\"file || gravatarUrl\" alt=\"用户头像\" class=\"user-avatar\" />\n    </div>\n    <div class=\"btn-box\">\n      <el-button type=\"primary\" class=\"chooseAvg\">\n        <input\n          type=\"file\"\n          name=\"file\"\n          accept=\".jpg,.png,.gif,.bmp\"\n          id=\"file\"\n          @change=\"choose\"\n        />\n        Choose Avatar\n      </el-button>\n      <el-button type=\"primary\" @click=\"uploadImg\">Confirm Avatar</el-button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport store from \"../store/index\";\nimport { mapState } from \"vuex\";\nimport http from \"@/utils/request\";\nimport { ElMessage } from \"element-plus\";\n\nexport default {\n  data() {\n    return {\n      isCollapse: false,\n      handleCollapse: null,\n      avg: \"\",\n    };\n  },\n  computed: {\n    ...mapState({\n      userInfo: (state) => state.userInfo,\n    }),\n    gravatarUrl() {\n      if (this.userInfo && this.userInfo.emailAddress) {\n        return this.userInfo.avatar === null\n          ? \"http://akarana.oss-ap-southeast-1.aliyuncs.com/car1.jpg\"\n          : this.userInfo.avatar;\n      }\n      return \"\";\n    },\n  },\n  methods: {\n    choose(event) {\n      let e = window.event || event;\n      if (e.target.files[0].size > 5 * 1024 * 1024) {\n      } else {\n        let file = e.target.files[0];\n\n        const formdate = new FormData();\n        formdate.append(\"avatar\", file);\n        this.formdate = formdate;\n        let reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.onload = (result) => {\n          this.file = result.target.result;\n        };\n      }\n      \n      // 添加选择完成提示\n      ElMessage({\n        message: \"Choose Complete\",\n        type: \"success\",\n      });\n    },\n    async uploadImg() {\n      const { data } = await http.post(\n        `/api/avatar/${this.userInfo.username}`,\n        this.formdate,\n        { headers: { \"Content-Type\": \"multipart/form-data\" } }\n      );\n      console.log(data);\n      localStorage.removeItem(\"userInfo\");\n      store.dispatch({\n        type: \"getUserInfo\",\n        payload: this.userInfo.id,\n      });\n      \n      // 添加上传成功提示\n      ElMessage({\n        message: \"Confirmed\",\n        type: \"success\",\n      });\n    },\n  },\n};\n\n</script>\n\n<style scoped>\n.chooseAvg {\n  position: relative;\n}\n/* <!-- 将头像放大 --> */\n.user-avatar {\n  width: 300px; /* 设置头像宽度 */\n  height: 300px; /* 设置头像高度 */\n  object-fit: cover; /* 设置图片的尺寸和容器尺寸不一致时如何适应容器 */\n  border-radius: 50%; /* 设置圆角 */\n  margin: 20px auto; /* 居中显示 */\n  display: block; /* 转为块级元素，使 margin:auto 居中生效 */\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 添加阴影效果 */\n}\n#file {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  opacity: 0;\n  z-index: 10;\n}\n.user-profile {\n  width: 80%;\n  margin: 0 auto;\n  padding: 20px;\n  background-color: #f5f5f5;\n  border-radius: 5px;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n  height: 100%;\n}\n\n.profile-title {\n  text-align: center; /* 居中对齐 */\n  font-size: 48px; /* 设置字体大小 */\n  font-weight: bold; /* 设置粗体 */\n  margin-bottom: 20px; /* 底部留白 */\n  color: #333; /* 字体颜色 */\n  padding: 20px; /* 内边距 */\n}\n\n.profile-content {\n  padding: 20px;\n}\n\n.profile-content p {\n  font-size: 18px;\n  margin-bottom: 10px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.profile-content span {\n  color: #333;\n}\n\n.profile-content input {\n  flex-grow: 1;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  padding: 6px 12px;\n  font-size: 14px;\n  margin-left: 8px;\n}\n\nbutton {\n  background-color: #ff8936;\n  border: none;\n  color: white;\n  text-align: center;\n  display: inline-block;\n  font-size: 16px;\n  transition-duration: 0.4s;\n  cursor: pointer;\n  padding: 8px 16px;\n  border-radius: 4px;\n  margin: 20px;\n}\n\nbutton:hover {\n  background-color: #45a049;\n}\n\n.editbut {\n  background-color: #1e90ff;\n}\n\n.editbut:hover {\n  background-color: #187bcd;\n}\n\n.profile-content input.error {\n  border-color: red;\n}\ninput.error {\n  border-color: red;\n  color: red;\n}\n.error,\n.profile-content span[data-v-ced23842].error {\n  color: red;\n}\n\n/* 居中选择头像和上传头像按钮 */\n.chooseAvg {\n  position: relative; /* 设置为相对定位 */\n  display: flex; /* 弹性盒子 */\n  justify-content: center; /* 水平居中 */\n  align-items: center; /* 垂直居中 */\n}\n\n.btn-box {\n  display: flex; /* 弹性盒子 */\n  justify-content: center; /* 水平居中 */\n  margin-top: 20px; /* 设置上边距 */\n}\n\n/* 将按钮放大 */\n.el-button {\n  font-size: 16px;\n  padding: 28px 96px;\n}\n\n.el-button {\n  display: inline-flex !important;\n  align-items: center;\n  justify-content: center;\n}\n</style>\n"],"mappings":"AAyBA,OAAOA,KAAI,MAAO,gBAAgB;AAClC,SAASC,QAAO,QAAS,MAAM;AAC/B,OAAOC,IAAG,MAAO,iBAAiB;AAClC,SAASC,SAAQ,QAAS,cAAc;AAExC,eAAe;EACbC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,UAAU,EAAE,KAAK;MACjBC,cAAc,EAAE,IAAI;MACpBC,GAAG,EAAE;IACP,CAAC;EACH,CAAC;EACDC,QAAQ,EAAE;IACR,GAAGP,QAAQ,CAAC;MACVQ,QAAQ,EAAGC,KAAK,IAAKA,KAAK,CAACD;IAC7B,CAAC,CAAC;IACFE,WAAWA,CAAA,EAAG;MACZ,IAAI,IAAI,CAACF,QAAO,IAAK,IAAI,CAACA,QAAQ,CAACG,YAAY,EAAE;QAC/C,OAAO,IAAI,CAACH,QAAQ,CAACI,MAAK,KAAM,IAAG,GAC/B,yDAAwD,GACxD,IAAI,CAACJ,QAAQ,CAACI,MAAM;MAC1B;MACA,OAAO,EAAE;IACX;EACF,CAAC;EACDC,OAAO,EAAE;IACPC,MAAMA,CAACC,KAAK,EAAE;MACZ,IAAIC,CAAA,GAAIC,MAAM,CAACF,KAAI,IAAKA,KAAK;MAC7B,IAAIC,CAAC,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,CAACC,IAAG,GAAI,IAAI,IAAG,GAAI,IAAI,EAAE,CAC9C,OAAO;QACL,IAAIC,IAAG,GAAIL,CAAC,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC;QAE5B,MAAMG,QAAO,GAAI,IAAIC,QAAQ,EAAE;QAC/BD,QAAQ,CAACE,MAAM,CAAC,QAAQ,EAAEH,IAAI,CAAC;QAC/B,IAAI,CAACC,QAAO,GAAIA,QAAQ;QACxB,IAAIG,MAAK,GAAI,IAAIC,UAAU,EAAE;QAC7BD,MAAM,CAACE,aAAa,CAACN,IAAI,CAAC;QAC1BI,MAAM,CAACG,MAAK,GAAKC,MAAM,IAAK;UAC1B,IAAI,CAACR,IAAG,GAAIQ,MAAM,CAACX,MAAM,CAACW,MAAM;QAClC,CAAC;MACH;;MAEA;MACA3B,SAAS,CAAC;QACR4B,OAAO,EAAE,iBAAiB;QAC1BC,IAAI,EAAE;MACR,CAAC,CAAC;IACJ,CAAC;IACD,MAAMC,SAASA,CAAA,EAAG;MAChB,MAAM;QAAE7B;MAAK,IAAI,MAAMF,IAAI,CAACgC,IAAI,CAC7B,eAAc,IAAI,CAACzB,QAAQ,CAAC0B,QAAS,EAAC,EACvC,IAAI,CAACZ,QAAQ,EACb;QAAEa,OAAO,EAAE;UAAE,cAAc,EAAE;QAAsB;MAAE,EACtD;MACDC,OAAO,CAACC,GAAG,CAAClC,IAAI,CAAC;MACjBmC,YAAY,CAACC,UAAU,CAAC,UAAU,CAAC;MACnCxC,KAAK,CAACyC,QAAQ,CAAC;QACbT,IAAI,EAAE,aAAa;QACnBU,OAAO,EAAE,IAAI,CAACjC,QAAQ,CAACkC;MACzB,CAAC,CAAC;;MAEF;MACAxC,SAAS,CAAC;QACR4B,OAAO,EAAE,WAAW;QACpBC,IAAI,EAAE;MACR,CAAC,CAAC;IACJ;EACF;AACF,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}